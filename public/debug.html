<!DOCTYPE html>
<html>
<head>
    <title>SkipLine - Diagnostic Complet</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f8ff; }
        .section { background: white; padding: 20px; margin: 20px 0; border-radius: 10px; border-left: 5px solid #007bff; }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        #log { background: #f8f9fa; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>üîç SkipLine - Diagnostic Complet</h1>
    
    <div class="section success">
        <h2>‚úÖ Cette page fonctionne !</h2>
        <p><strong>URL actuelle :</strong> <span id="currentUrl"></span></p>
        <p><strong>Timestamp :</strong> <span id="timestamp"></span></p>
        <p>Si vous voyez ce message, Netlify peut servir des pages statiques.</p>
    </div>

    <div class="section">
        <h2>üß™ Tests de Navigation</h2>
        <button class="btn-primary" onclick="testUrl('/dashboard/client')">Test /dashboard/client</button>
        <button class="btn-primary" onclick="testUrl('/auth/login')">Test /auth/login</button>
        <button class="btn-primary" onclick="testUrl('/auth/register')">Test /auth/register</button>
        <button class="btn-success" onclick="testUrl('/')">Test Homepage /</button>
        <button class="btn-danger" onclick="testUrl('/route-inexistante')">Test 404</button>
    </div>

    <div class="section">
        <h2>üìã Log des Tests</h2>
        <button onclick="clearLog()">Clear Log</button>
        <div id="log"></div>
    </div>

    <div class="section">
        <h2>üåê Informations Navigateur</h2>
        <p><strong>User Agent :</strong> <span id="userAgent"></span></p>
        <p><strong>Cookies :</strong> <span id="cookies"></span></p>
        <p><strong>Local Storage :</strong> <span id="localStorage"></span></p>
    </div>

    <div class="section">
        <h2>‚ö° Tests Supabase</h2>
        <button class="btn-primary" onclick="testSupabase()">Tester Connexion Supabase</button>
        <div id="supabaseResult"></div>
    </div>

    <script>
        // Initialisation
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('timestamp').textContent = new Date().toLocaleString();
        document.getElementById('userAgent').textContent = navigator.userAgent.substring(0, 100) + '...';
        document.getElementById('cookies').textContent = document.cookie || 'Aucun cookie';
        
        try {
            document.getElementById('localStorage').textContent = JSON.stringify(localStorage).substring(0, 100) + '...';
        } catch(e) {
            document.getElementById('localStorage').textContent = 'Erreur: ' + e.message;
        }

        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `${time}: ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function testUrl(url) {
            log(`üîç Test de navigation vers: ${url}`);
            
            // Test avec fetch d'abord
            fetch(url)
                .then(response => {
                    log(`üì° Fetch ${url}: Status ${response.status} (${response.statusText})`);
                    log(`üìç Final URL: ${response.url}`);
                    
                    if (response.url !== window.location.origin + url) {
                        log(`‚ö†Ô∏è REDIRECTION D√âTECT√âE! ${url} ‚Üí ${response.url}`);
                    }
                })
                .catch(error => {
                    log(`‚ùå Erreur fetch ${url}: ${error.message}`);
                });

            // Test navigation dans 2 secondes
            setTimeout(() => {
                log(`üöÄ Navigation vers ${url}...`);
                window.location.href = url;
            }, 2000);
        }

        function testSupabase() {
            const supabaseUrl = 'https://gslrmhsrxwfucttbcbnm.supabase.co';
            
            log('üîó Test connexion Supabase...');
            
            fetch(supabaseUrl + '/rest/v1/', {
                headers: {
                    'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdzjnJtaHNyeHdmdWN0dGJjYm5tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1NzcwNTgsImV4cCI6MjA2OTE1MzA1OH0.a3Ld4z_3Bp2MBsQvt4zNjOyagObm_VPCCo-G9x0Y3nI'
                }
            })
            .then(response => {
                log(`‚úÖ Supabase: Status ${response.status}`);
                document.getElementById('supabaseResult').innerHTML = 
                    `<p style="color: green;">‚úÖ Connexion Supabase OK (${response.status})</p>`;
            })
            .catch(error => {
                log(`‚ùå Erreur Supabase: ${error.message}`);
                document.getElementById('supabaseResult').innerHTML = 
                    `<p style="color: red;">‚ùå Erreur Supabase: ${error.message}</p>`;
            });
        }

        // Auto-log au chargement
        log('üìÑ Page de diagnostic charg√©e');
        log('üåê URL: ' + window.location.href);
    </script>
</body>
</html>
